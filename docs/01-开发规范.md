# 开发规范与数据安全要求

## 适用范围
- 本规范适用于“项目卡片及项目推进表生成器”项目的日常开发、测试、发布与版本管理。

## 环境与分支
- 所有修改在合入主分支前，必须先在“测试环境”验证通过。
- 测试环境以 `docker-compose.test.yml` 启动，端口为 `18898`，数据文件位于 `env/test/project_cards.json`（默认空数组）。
- 分支策略：
  - `main`：稳定分支，仅合并通过测试的变更。
  - `feature/*`：功能开发分支。
  - `release/sanitized-*`：脱敏发布分支，用于对外同步代码（清空数据或替换为示例数据）。

## 数据安全
- 本地数据文件 `project_cards.json` 已被 `.gitignore` 忽略，不得提交到远端。
- 当需要“同步 git / 开设新分支”时：
  - 使用测试环境或脱敏分支进行提交和推送。
  - 脱敏处理包括但不限于：清空数据文件、移除真实密钥、使用示例文本。
  - 不影响本地正在使用的数据（避免覆盖或删除本地 `project_cards.json`）。
- AI Key 等敏感信息仅保存在浏览器 `localStorage` 或本地导出配置文件，不上传或提交至仓库。

## 提交流程
1. 在 `feature/*` 分支开发并自测。
2. 使用 `docker-compose.test.yml` 启动测试环境，验证页面功能与数据读写。
3. 创建 `release/sanitized-YYYYMMDD` 分支，确保：
   - `env/test/project_cards.json` 为 `[]`；
   - 不包含任何真实数据或密钥；
   - 文档与说明完整。
4. 提交并推送 `release/sanitized-*` 分支。
5. 评审后再合入 `main`。

## 代码与配置
- 优先遵循现有代码风格与依赖选择（React/CDN、Tailwind、Babel）。
- 仅在必要时新增文件，避免不必要的复杂度。
- 服务器端 `server.py` 默认读取 `project_cards.json`，测试环境通过挂载空数据文件实现脱敏，不更改本地逻辑。

## 文档与变更记录
- 所有重要变更需更新 `docs/00-项目说明.md` 与 `README.md`，保持测试环境与数据策略的描述一致。
- 提交信息（commit message）应清晰描述目的、内容与影响范围。

## 编号命名规范
- 推荐结构：`[客户代号]-[项目代号]-S[阶段]-[S/P][序号]`
  - 支持 3 段或 4 段：最少需包含 `S[阶段]`，可选包含 `S/P[序号]`
  - 示例：`ACME-PJT-S1-P01`、`1205-S2-S01`
  - 连字符可输入为 `-`、`—`、`–`、`－`，系统将自动规范为半角 `-`
  - 字母大小写不敏感，系统自动转换为大写

## 多项目架构（新）
- 引入两级数据模型：
  - 项目层 (`projects.json`)：管理合同、预算、货架清单等元数据。
  - 卡片层 (`project_cards.json`)：通过编号前缀与项目自动关联。
- 新增页面：
  - `projects.html`：项目看板，作为新的系统入口。
  - `project_detail.html`：项目详情页，负责元数据维护与卡片管理。
- 关联逻辑：
  - 项目通过 `[客户代号]-[项目代号]` 作为前缀标识。
  - 卡片编号以此前缀开头即被视为该项目的一部分。
  - 新建卡片时自动携带前缀参数 `projectPrefix`。

## 未来扩展（预留）
- 引入自动化测试（前端快照、接口模拟）。
- 增加 CI 工作流，对 `release/sanitized-*` 分支进行构建与静态检查。
- 数据迁移脚本：将历史 Markdown/JSON 统一转换为标准结构并生成示例数据集。
