<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>16:9 项目卡片生成器 (Smart Layout)</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; margin: 0; padding: 0; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.2); }

        .card-shadow {
            box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        /* List Number Styling */
        .item-list-counter {
            counter-reset: item;
        }
        .item-list-li {
            counter-increment: item;
            position: relative;
            padding-left: 1.2em;
        }
        .item-list-li::before {
            content: "•";
            position: absolute;
            left: 0;
            font-weight: bold;
            opacity: 0.6;
            color: currentColor;
        }
    </style>
</head>
<body class="bg-gray-100 text-slate-800 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useLayoutEffect, useMemo } = React;

        const DEFAULT_TEXT = `项目编号：1205-S1-S02
项目名称：数字风洞健康管理服务
项目目标：基于数字风洞平台构建业务资产健康管理体系，实现IT资产与风险的数字化闭环管理。通过统一工具与方法论，提升人员安全治理能力，降低安全事件概率，有效收敛攻击面。
现状分析：
1. IT资产分散、台账不完整，缺乏统一健康档案与风险追踪机制
2. 互联网暴露资产不清晰，存在未知风险入口。
3. 核心资产（研发服务器、生产数据库、代码仓库等）访问路径宽松，缺乏分级保护策略。
项目周期：
分三步推进：
第一步（1个月）：平台部署与资产基础梳理，启动互联网暴露面排查。
第二步（2-3个月）：完成健康管理工具集成与风险闭环流程设计，实施核心资产架构梳理。
第三步（1-2个月）：全面推行管理闭环，完成方法论培训与运维移交。
预算投入：平台租赁：32万；暴露面梳理服务：约15人天，9万；资产梳理咨询服务：约20人天，12万；
所需支持：
1. 组织协同：客户需明确对接团队，协调IT、安全、业务部门提供资产信息与访问权限。
2. 数据与接口：开放现有资产管理系统、网络拓扑、日志等数据接口。
3. 试点配合：提供核心业务系统作为试点，验证管理闭环有效性。
项目内容：
1. 数字健康管理服务
   - 建立IT资产电子档案，实现台账化管理。
   - 建立风险管理流程，实现风险闭环管理。
2. 互联网暴露面排查服务
   - 通过暴露面管理技术，全面识别集团互联网侧资产。
   - 输出暴露面清单与风险评级，为统一管控提供依据。
3. 资产与架构梳理服务
   - 定位核心研发服务器、生产数据库、代码仓库等关键资产。
   - 分析资产间访问路径，识别过度宽松的权限策略，提出收缩方案。
参与部门：信息安全部；产品线研发部；业务部门
相关产品及解决方案：数字风洞平台部署、互联网暴露面排查服务、数字资产与架构梳理服务（需内部协同）
输出物：
1. 管理平台：部署完成的数字风洞健康管理平台（含资产台账、风险闭环模块）。
2. 排查报告：互联网暴露面资产清单、风险分析报告。
3. 架构梳理成果：核心资产清单、访问路径矩阵、攻击面收缩建议方案。
4. 管理手册：平台操作与运维手册。
项目价值总结：通过系统化工具与方法论赋能，帮助1205实现IT资产的可知、可控、可管，建立主动式安全治理闭环，提升整体安全运营效率。`;

        // --- KEY MAPPING & WHITELIST ---
        const KEY_MAP = {
            '项目名称': '项目名称', '标题': '项目名称', 'Name': '项目名称',
            '项目目标': '项目目标', '目标': '项目目标', 'Goal': '项目目标',
            '项目价值总结': '项目目标', '价值': '项目目标', // Merge Value into Goal
            '现状分析': '现状分析', '背景': '现状分析', 'Status': '现状分析',
            '项目周期': '项目周期', '周期': '项目周期', 'Time': '项目周期',
            '预算投入': '预算投入', '预算': '预算投入', 'Budget': '预算投入',
            '所需支持': '所需支持', '支持': '所需支持', 'Support': '所需支持',
            '项目内容': '项目内容', '内容': '项目内容', 'Content': '项目内容',
            '参与部门': '参与部门', '部门': '参与部门', 'Team': '参与部门',
            '相关产品及解决方案': '相关产品及解决方案', '相关产品': '相关产品及解决方案', '产品': '相关产品及解决方案', '解决方案': '相关产品及解决方案',
            '输出物': '输出物', '交付物': '输出物', 'Output': '输出物',
            '项目编号': 'CardId', '编号': 'CardId'
        };

        // --- TYPOGRAPHY COMPONENT ---
        const DynamicText = ({ content, className = "", isBudget = false, compactMode = false }) => {
            if (!content) return <span className="opacity-0">.</span>;
            const length = content.length;
            
            // Budget Handling - 放大字号
            if (isBudget) {
                let sizeClass = "text-5xl leading-tight"; // Base enlarged
                if (length > 50) sizeClass = "text-lg leading-snug";
                else if (length > 30) sizeClass = "text-xl leading-snug";
                else if (length > 20) sizeClass = "text-2xl leading-snug";
                else if (length > 10) sizeClass = "text-3xl leading-snug";
                else if (length > 6) sizeClass = "text-4xl leading-snug";
                
                return <div className={`${sizeClass} font-bold font-mono whitespace-pre-wrap break-words px-1 ${className}`}>{content}</div>;
            }

            // Adaptive Sizing - 增加更小字号的兼容性
            let textSizeClass = "text-lg leading-relaxed"; // Default
            if (length > 1000) textSizeClass = "text-[10px] leading-tight tracking-tight"; // Ultra compact
            else if (length > 800) textSizeClass = "text-[11px] leading-snug";
            else if (length > 500) textSizeClass = "text-[13px] leading-snug";
            else if (length > 300) textSizeClass = "text-sm leading-snug";
            else if (length > 150) textSizeClass = "text-[15px] leading-normal";
            else if (length > 80) textSizeClass = "text-base leading-relaxed";

            // List Detection
            const hasListMarkers = content.match(/(\n|;|；|\[·\]|\[-\]|\d+\.\s)/);
            
            if (hasListMarkers) {
                let processed = content
                    .replace(/\[·\]/g, '')
                    .replace(/\[-\]/g, '')
                    .replace(/[;；]/g, '\n');
                
                const items = processed.split('\n').map(i => i.trim()).filter(i => i);
                
                if (items.length <= 1 && !content.includes('\n')) {
                     return <div className={`${textSizeClass} whitespace-pre-wrap ${className}`}>{content}</div>;
                }

                // If content is huge, reduce gap
                const gapClass = (length > 400 || items.length > 8) ? "gap-0.5" : "gap-2";

                return (
                    <ul className={`item-list-counter flex flex-col ${gapClass} ${textSizeClass} ${className}`}>
                        {items.map((item, idx) => (
                            <li key={idx} className="item-list-li">
                                {/* Bold the list number if it starts with digit */}
                                {item.match(/^\d+\./) ? <span className="font-semibold mr-1">{item.split(/(^\d+\.)/)[1]}</span> : null}
                                {item.replace(/^\d+\.\s*/, '')}
                            </li>
                        ))}
                    </ul>
                );
            }

            return <div className={`${textSizeClass} whitespace-pre-wrap ${className}`}>{content}</div>;
        };

        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => {
                lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        // --- CARD COMPONENT ---
        const ProjectCard = ({ data, cardId, themeColor, accentColor, textColor, cardBg, budgetColor }) => {
            
            // --- DYNAMIC HEIGHT CALCULATION ---
            // Calculate weights based on text length to distribute flex space
            const lenTarget = (data['项目目标'] || '').length;
            const lenStatus = (data['现状分析'] || '').length;
            const lenContent = (data['项目内容'] || '').length;
            const lenSupport = (data['所需支持'] || '').length;

            const row1Weight = Math.max(lenTarget, lenStatus, 50); // Min weight 50
            const row2Weight = Math.max(lenContent, 100); 
            const row3Weight = Math.max(lenSupport, 30); // Budget is small, support drives this row

            const totalLeftWeight = row1Weight + row2Weight + row3Weight;
            
            // Convert to flex grow values (simplified ratio)
            const flex1 = (row1Weight / totalLeftWeight) * 10; 
            // Give extra weight to content row to prevent cutoff
            const flex2 = (row2Weight / totalLeftWeight) * 12; 
            const flex3 = (row3Weight / totalLeftWeight) * 10;

            // Right Column Calculation
            const lenPeriod = (data['项目周期'] || '').length;
            const lenTeam = (data['参与部门'] || '').length;
            const lenProduct = (data['相关产品及解决方案'] || '').length;
            const lenOutput = (data['输出物'] || '').length;
            
            const totalRightWeight = lenPeriod + lenTeam + lenProduct + lenOutput + 100; // +100 base
            const rFlex1 = Math.max(lenPeriod, 40) / totalRightWeight * 10;
            const rFlex2 = Math.max(lenTeam, 30) / totalRightWeight * 10;
            const rFlex3 = Math.max(lenProduct, 30) / totalRightWeight * 10;
            const rFlex4 = Math.max(lenOutput, 60) / totalRightWeight * 10;

            const renderSection = (title, iconName, customClass = "", iconSize = 22) => {
                const content = data[title];
                if (content === undefined && title !== '预算投入') return null;

                return (
                    <div className={`flex flex-col gap-2 h-full ${customClass}`}>
                        <div className="flex items-center gap-2 font-bold uppercase tracking-wider text-sm opacity-90 shrink-0" style={{ color: themeColor }}>
                            <Icon name={iconName} size={iconSize} />
                            <span>{title}</span>
                        </div>
                        <div className="opacity-95 flex-1 min-h-0 overflow-hidden" style={{ color: textColor }}>
                            <DynamicText content={content} />
                        </div>
                    </div>
                );
            };

            return (
                <div 
                    className="w-[1920px] h-[1080px] p-10 flex flex-col relative overflow-hidden bg-white text-lg shadow-none box-border"
                    style={{ backgroundColor: cardBg, color: textColor }}
                >
                    {/* Background Accents */}
                    <div className="absolute top-0 right-0 w-[900px] h-[900px] rounded-full opacity-[0.04] blur-3xl pointer-events-none -translate-y-1/2 translate-x-1/3" style={{ backgroundColor: themeColor }}></div>
                    <div className="absolute bottom-0 left-0 w-[700px] h-[700px] rounded-full opacity-[0.04] blur-3xl pointer-events-none translate-y-1/3 -translate-x-1/4" style={{ backgroundColor: themeColor }}></div>
                    <div className="absolute top-12 bottom-12 left-0 w-3 rounded-r-xl" style={{ backgroundColor: themeColor }}></div>

                    {/* HEADER */}
                    <div className="flex items-end gap-10 border-b-2 pb-5 mb-6 shrink-0" style={{ borderColor: `${themeColor}25` }}>
                        <h1 className="text-6xl font-black tracking-tight leading-none truncate flex-1 pt-2" style={{ color: textColor }}>
                            {data['项目名称'] || '项目名称'}
                        </h1>
                        <div className="flex items-center gap-4 opacity-70 mb-2">
                            {cardId && (
                                <span className="text-2xl font-mono font-bold tracking-widest uppercase border-2 px-4 py-1 rounded-lg" style={{ borderColor: textColor }}>
                                    {cardId}
                                </span>
                            )}
                        </div>
                    </div>

                    {/* CONTENT GRID */}
                    <div className="flex-1 grid grid-cols-12 gap-8 min-h-0">
                        {/* LEFT COLUMN (8 cols) - Dynamic Flex Layout */}
                        <div className="col-span-8 flex flex-col gap-6 h-full min-h-0">
                            
                            {/* Row 1: Target & Status - Dynamic Height */}
                            <div className="grid grid-cols-2 gap-6 shrink-0" style={{ flex: `${Math.max(flex1, 2)} 1 0%`, minHeight: '150px' }}>
                                <div className="rounded-[1.5rem] p-6 border border-gray-200/50 shadow-sm overflow-hidden flex flex-col" style={{ backgroundColor: `${accentColor}90` }}>
                                    {renderSection('项目目标', 'target', 'h-full', 26)}
                                </div>
                                <div className="rounded-[1.5rem] p-6 border border-gray-200/50 shadow-sm overflow-hidden flex flex-col" style={{ backgroundColor: `${accentColor}90` }}>
                                    {renderSection('现状分析', 'bar-chart-2', 'h-full', 26)}
                                </div>
                            </div>
                            
                            {/* Row 2: Content (Main) - Dynamic Height */}
                            <div className="rounded-[1.5rem] p-6 border border-gray-200 shadow-sm relative overflow-hidden flex flex-col" style={{ backgroundColor: accentColor, flex: `${Math.max(flex2, 2)} 1 0%`, minHeight: '180px' }}>
                                <div className="absolute right-8 bottom-8 opacity-[0.05] pointer-events-none">
                                    <Icon name="layers" size={260} />
                                </div>
                                <div className="relative z-10 h-full overflow-hidden">
                                    {renderSection('项目内容', 'file-text', 'h-full', 30)}
                                </div>
                            </div>
                            
                            {/* Row 3: Support & Budget - Dynamic Height */}
                            <div className="grid grid-cols-12 gap-6 shrink-0" style={{ flex: `${Math.max(flex3, 1.5)} 1 0%`, minHeight: '140px' }}>
                                <div className="col-span-8 rounded-[1.5rem] p-6 border border-gray-200/50 shadow-sm overflow-hidden flex flex-col" style={{ backgroundColor: `${accentColor}90` }}>
                                    {renderSection('所需支持', 'life-buoy', 'h-full', 26)}
                                </div>
                                <div 
                                    className="col-span-4 rounded-[1.5rem] p-5 border border-gray-200/50 shadow-sm flex flex-col justify-center items-center text-center relative overflow-hidden" 
                                    style={{ backgroundColor: budgetColor }}
                                >
                                    <div className="absolute inset-0 bg-white opacity-[0.1] pointer-events-none"></div>
                                    <div className="relative z-10 text-white w-full h-full flex flex-col justify-center">
                                        <div className="flex items-center justify-center gap-2 opacity-90 mb-3 shrink-0">
                                            <Icon name="coins" size={30} className="text-white" />
                                            <span className="text-lg font-bold uppercase tracking-widest">预算投入</span>
                                        </div>
                                        <div className="flex items-center justify-center flex-1 w-full overflow-hidden">
                                            <DynamicText content={data['预算投入'] || '-'} isBudget={true} className="text-white" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* RIGHT COLUMN (4 cols) - Dynamic Flex Layout */}
                        <div className="col-span-4 flex flex-col gap-6 h-full min-h-0 pl-2">
                            <div className="p-6 rounded-[1.5rem] border-2 border-dashed border-gray-300 bg-white/60 overflow-hidden" style={{ flex: `${Math.max(rFlex1, 1)} 1 0%`, minHeight: '120px' }}>
                                {renderSection('项目周期', 'clock', 'h-full', 26)}
                            </div>
                            <div className="p-6 rounded-[1.5rem] border border-gray-200 bg-white/40 overflow-hidden" style={{ flex: `${Math.max(rFlex2, 1)} 1 0%`, minHeight: '100px' }}>
                                {renderSection('参与部门', 'users', 'h-full', 26)}
                            </div>
                            <div className="p-6 rounded-[1.5rem] border border-gray-200 bg-white/40 overflow-hidden" style={{ flex: `${Math.max(rFlex3, 1)} 1 0%`, minHeight: '100px' }}>
                                {renderSection('相关产品及解决方案', 'box', 'h-full', 26)}
                            </div>
                            <div className="p-6 rounded-[1.5rem] border border-gray-200 bg-white/40 overflow-hidden" style={{ flex: `${Math.max(rFlex4, 1.5)} 1 0%`, minHeight: '150px' }}>
                                {renderSection('输出物', 'check-circle', 'h-full', 26)}
                            </div>
                            
                            <div className="mt-auto pt-2 flex justify-between items-end opacity-40 shrink-0">
                                <span className="text-sm font-bold tracking-[0.3em]">CONFIDENTIAL</span>
                                <div className="flex items-center gap-2 text-sm font-bold">
                                    <Icon name="activity" size={20} />
                                    PROJECT CARD
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [rawText, setRawText] = useState(DEFAULT_TEXT);
            const [cardId, setCardId] = useState("PROJ-2024-001");
            const [parsedData, setParsedData] = useState({});
            
            const [themeColor, setThemeColor] = useState("#0f172a"); 
            const [accentColor, setAccentColor] = useState("#f1f5f9"); 
            const [textColor, setTextColor] = useState("#334155"); 
            const [cardBg, setCardBg] = useState("#FFFFFF");
            const [budgetColor, setBudgetColor] = useState("#b45309"); 
            
            const previewContainerRef = useRef(null);
            const [scale, setScale] = useState(0.5);

            // --- WHITELIST PARSING LOGIC ---
            useEffect(() => {
                const lines = rawText.split('\n');
                const data = {};
                let currentKey = null;
                
                const keyPattern = /^(\*\*)?([^*：:\n\r]{1,20})(\*\*)?\s*[:：](.*)/;

                lines.forEach(line => {
                    const cleanLine = line.trim();
                    if (!cleanLine) {
                        if (currentKey) data[currentKey] += '\n';
                        return;
                    }

                    const match = cleanLine.match(keyPattern);
                    let isNewKey = false;

                    if (match) {
                        const rawKey = match[2].trim();
                        const mappedKey = KEY_MAP[rawKey];
                        
                        if (mappedKey) {
                            currentKey = mappedKey;
                            const newVal = match[4].trim();
                            // Append if merging (like Value Summary -> Goal)
                            if (data[currentKey]) {
                                data[currentKey] += '\n' + newVal;
                            } else {
                                data[currentKey] = newVal;
                            }
                            isNewKey = true;
                            
                            // Check for Project ID update
                            if (mappedKey === 'CardId') {
                                setCardId(newVal);
                            }
                        } else if (rawKey === 'CardId' || rawKey === '项目编号' || rawKey === '编号') {
                             setCardId(match[4].trim());
                             return; 
                        }
                    }

                    if (!isNewKey) {
                        if (currentKey) {
                            data[currentKey] = (data[currentKey] ? data[currentKey] + '\n' : '') + cleanLine;
                        }
                    }
                });
                setParsedData(data);
            }, [rawText]);

            useLayoutEffect(() => {
                const handleResize = () => {
                    if (previewContainerRef.current) {
                        const { width, height } = previewContainerRef.current.getBoundingClientRect();
                        const availableWidth = width - 40; 
                        const availableHeight = height - 40;
                        const scaleX = availableWidth / 1920;
                        const scaleY = availableHeight / 1080;
                        setScale(Math.min(scaleX, scaleY));
                    }
                };
                window.addEventListener('resize', handleResize);
                handleResize(); 
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            const cardProps = { data: parsedData, cardId, themeColor, accentColor, textColor, cardBg, budgetColor };

            return (
                <div className="h-screen flex flex-col lg:flex-row font-sans overflow-hidden">
                    
                    {/* 2. CONTROLS */}
                    <div className="w-full lg:w-96 bg-white border-r border-gray-200 flex flex-col h-full z-20 shadow-xl shrink-0">
                        <div className="p-6 flex flex-col gap-4 overflow-y-auto custom-scroll flex-1">
                            <div>
                                <h1 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                    <Icon name="layout-template" size={20} />
                                    项目卡片生成器
                                </h1>
                                <p className="text-xs text-gray-500 mt-1">
                                    智能动态布局版 · 自动适应长文本
                                </p>
                            </div>

                            <div className="space-y-3">
                                 <div>
                                    <label className="text-xs font-semibold text-gray-600">项目编号</label>
                                    <input 
                                        type="text"
                                        className="w-full mt-1 p-2 text-sm border border-gray-300 rounded focus:border-blue-500 outline-none"
                                        value={cardId}
                                        onChange={(e) => setCardId(e.target.value)}
                                    />
                                </div>
                                <div>
                                    <label className="text-xs font-semibold text-gray-600">卡片内容 (智能识别)</label>
                                    <textarea 
                                        className="w-full mt-1 h-64 p-2 text-sm border border-gray-300 rounded focus:border-blue-500 outline-none font-mono leading-relaxed"
                                        value={rawText}
                                        onChange={(e) => setRawText(e.target.value)}
                                        placeholder="直接粘贴包含：项目名称、目标、内容、预算...的文本"
                                    />
                                </div>
                            </div>

                            <div className="space-y-3">
                                <label className="text-xs font-semibold text-gray-600">配色风格</label>
                                <div className="grid grid-cols-2 gap-2">
                                    <div className="space-y-1">
                                        <span className="text-[10px] text-gray-400">主色</span>
                                        <input type="color" value={themeColor} onChange={(e) => setThemeColor(e.target.value)} className="w-full h-8 rounded border border-gray-200 cursor-pointer" />
                                    </div>
                                    <div className="space-y-1">
                                        <span className="text-[10px] text-gray-400">预算色</span>
                                        <input type="color" value={budgetColor} onChange={(e) => setBudgetColor(e.target.value)} className="w-full h-8 rounded border border-gray-200 cursor-pointer" />
                                    </div>
                                    <div className="space-y-1">
                                        <span className="text-[10px] text-gray-400">背景</span>
                                        <input type="color" value={cardBg} onChange={(e) => setCardBg(e.target.value)} className="w-full h-8 rounded border border-gray-200 cursor-pointer" />
                                    </div>
                                    <div className="space-y-1">
                                        <span className="text-[10px] text-gray-400">区块底色</span>
                                        <input type="color" value={accentColor} onChange={(e) => setAccentColor(e.target.value)} className="w-full h-8 rounded border border-gray-200 cursor-pointer" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="p-4 border-t border-gray-200 bg-gray-50 text-center text-xs text-gray-400">
                             卡片预览模式 (下载功能已禁用)
                        </div>
                    </div>

                    {/* 3. VISUAL PREVIEW AREA (Scaled) */}
                    <div 
                        ref={previewContainerRef}
                        className="flex-1 bg-gray-200 relative overflow-hidden flex items-center justify-center"
                    >
                        <div className="absolute inset-0 opacity-10" style={{ 
                            backgroundImage: 'linear-gradient(#475569 1px, transparent 1px), linear-gradient(90deg, #475569 1px, transparent 1px)',
                            backgroundSize: '40px 40px'
                        }}></div>

                        <div 
                            style={{ 
                                width: '1920px', 
                                height: '1080px', 
                                transform: `scale(${scale})`, 
                                transformOrigin: 'center center',
                                boxShadow: '0 0 100px rgba(0,0,0,0.2)'
                            }}
                            className="shrink-0 relative pointer-events-none select-none"
                        >
                            <ProjectCard {...cardProps} />
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>